<div class="auth-container">
    <!-- LADO IZQUIERDO -->
    <div class="auth-left">
        <h1 class="welcome-text">¡Bienvenido!</h1>
        <img class="main-icon" src="img/Logo_Optica_Macias.png" alt="Logo Óptica">
        <p class="motivation-text">
            Aquí vemos diferente!
        </p>

        <div class="dots">
            <span class="dot" [class.active]="activeSlide() === 1" (click)="goTo(1)"></span>
            <span class="dot" [class.active]="activeSlide() === 2" (click)="goTo(2)"></span>
            <span class="dot" [class.active]="activeSlide() === 3" (click)="goTo(3)"></span>
        </div>
    </div>

    <!-- LADO DERECHO -->
    <div class="auth-right">

        <!-- LOGIN -->
        <div class="form-slide" *ngIf="activeSlide() === 1" @fadeSlide>
            <h2 class="auth-title">Iniciar Sesión</h2>
            <p class="auth-subtitle">Acceso para empleados de la óptica</p>

            <form class="auth-form" [formGroup]="loginForm" (ngSubmit)="onLogin()">
                <!-- Email -->
                <div class="form-group">
                    <label>Correo electrónico:</label>
                    <div class="input-wrapper">
                        <input type="email" formControlName="email" placeholder="ejemplo@optica.com" [class.invalid]="loginForm.get('email')?.invalid && loginForm.get('email')?.touched" appEnterNext>
                        <div class="warning-icon" *ngIf="loginForm.get('email')?.touched && loginForm.get('email')?.invalid">
                            <span class="tooltip">
                                <ng-container *ngIf="loginForm.get('email')?.hasError('required')">Correo requerido.<br></ng-container>
                                <ng-container *ngIf="loginForm.get('email')?.hasError('email')">Formato de correo inválido.</ng-container>
                            </span>
                            <svg class="lucide lucide-message-circle-warning" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path>
                                <path d="M12 8v4"></path>
                                <path d="M12 16h.01"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Contraseña -->
                <div class="form-group">
                    <label>Contraseña:</label>
                    <div class="input-wrapper">
                        <input [type]="showPassword() ? 'text' : 'password'" formControlName="password" placeholder="********" [class.invalid]="loginForm.get('password')?.invalid && loginForm.get('password')?.touched" appEnterNext>
                        <button type="button" class="toggle-password" (click)="togglePasswordVisibility('login')" tabindex="-1">
                            <svg *ngIf="!showPassword()" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                            <svg *ngIf="showPassword()" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/>
                                <path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/>
                                <path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"/>
                                <line x1="2" x2="22" y1="2" y2="22"/>
                            </svg>
                        </button>
                        <div class="warning-icon" *ngIf="loginForm.get('password')?.touched && loginForm.get('password')?.invalid">
                            <span class="tooltip">
                                <ng-container *ngIf="loginForm.get('password')?.hasError('required')">Contraseña requerida.<br></ng-container>
                                <ng-container *ngIf="loginForm.get('password')?.hasError('minlength')">Mínimo 6 caracteres.</ng-container>
                            </span>
                            <svg class="lucide lucide-message-circle-warning" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path>
                                <path d="M12 8v4"></path>
                                <path d="M12 16h.01"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <button class="auth-btn" type="submit" [disabled]="loginForm.invalid || isLoading">
                    <span *ngIf="!isLoading">Ingresar</span>
                    <span *ngIf="isLoading">Ingresando...</span>
                </button>
            </form>

            <div class="auth-links">
                <a (click)="goTo(2)">¿No tienes cuenta? Regístrate</a>
                <a (click)="goTo(3)" style="cursor: pointer;">¿Olvidaste tu contraseña?</a>
            </div>
        </div>

        <!-- REGISTRO -->
        <div class="form-slide" *ngIf="activeSlide() === 2" @fadeSlide>
            <h2 class="auth-title">Crear Cuenta</h2>
            <p class="auth-subtitle">Registro para nuevos empleados</p>

            <form class="auth-form" [formGroup]="registerForm" (ngSubmit)="onRegister()">
                <!-- Cédula -->
                <div class="form-group">
                    <label>Cédula:</label>
                    <div class="input-wrapper">
                        <input type="text" formControlName="cedula" maxlength="10" placeholder="1234567890" appEnterNext>
                        <div class="warning-icon" *ngIf="registerForm.get('cedula')?.invalid && (registerForm.get('cedula')?.touched || registerForm.get('cedula')?.dirty || registerForm.get('cedula')?.hasError('cedulaTomada'))">
                            <span class="tooltip">
                                <ng-container *ngIf="registerForm.get('cedula')?.hasError('required')">Cédula requerida.<br></ng-container>
                                <ng-container *ngIf="registerForm.get('cedula')?.hasError('maxlength')">Máximo 10 dígitos.<br></ng-container>
                                <ng-container *ngIf="registerForm.get('cedula')?.hasError('pattern')">Solo números permitidos.<br></ng-container>
                                <ng-container *ngIf="registerForm.get('cedula')?.hasError('cedulaTomada')">Esta cédula ya está registrada.</ng-container>
                            </span>
                            <svg class="lucide lucide-message-circle-warning" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path>
                                <path d="M12 8v4"></path>
                                <path d="M12 16h.01"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Nombre -->
                <div class="form-group">
                    <label>Nombre:</label>
                    <div class="input-wrapper">
                        <input type="text" formControlName="nombre" placeholder="Juan" appEnterNext>
                        <div class="warning-icon" *ngIf="registerForm.get('nombre')?.touched && registerForm.get('nombre')?.invalid">
                            <span class="tooltip">
                                <ng-container *ngIf="registerForm.get('nombre')?.hasError('required')">Nombre requerido.<br></ng-container>
                                <ng-container *ngIf="registerForm.get('nombre')?.hasError('minlength')">Mínimo 2 caracteres.<br></ng-container>
                                <ng-container *ngIf="registerForm.get('nombre')?.hasError('pattern')">Solo letras permitidas.</ng-container>
                            </span>
                            <svg class="lucide lucide-message-circle-warning" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path>
                                <path d="M12 8v4"></path>
                                <path d="M12 16h.01"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Apellido -->
                <div class="form-group">
                    <label>Apellido:</label>
                    <div class="input-wrapper">
                        <input type="text" formControlName="apellido" placeholder="Pérez" appEnterNext>
                        <div class="warning-icon" *ngIf="registerForm.get('apellido')?.touched && registerForm.get('apellido')?.invalid">
                            <span class="tooltip">
                                <ng-container *ngIf="registerForm.get('apellido')?.hasError('required')">Apellido requerido.<br></ng-container>
                                <ng-container *ngIf="registerForm.get('apellido')?.hasError('minlength')">Mínimo 2 caracteres.<br></ng-container>
                                <ng-container *ngIf="registerForm.get('apellido')?.hasError('pattern')">Solo letras permitidas.</ng-container>
                            </span>
                            <svg class="lucide lucide-message-circle-warning" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path>
                                <path d="M12 8v4"></path>
                                <path d="M12 16h.01"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Fecha de nacimiento -->
                <div class="form-group">
                    <label>Fecha de nacimiento:</label>
                    <div class="input-wrapper">
                        <input type="date" formControlName="fechaNacimiento" appEnterNext>
                        <div class="warning-icon" *ngIf="registerForm.get('fechaNacimiento')?.touched && registerForm.get('fechaNacimiento')?.invalid">
                            <span class="tooltip">
                                <ng-container *ngIf="registerForm.get('fechaNacimiento')?.hasError('required')">Fecha requerida.<br></ng-container>
                                <ng-container *ngIf="registerForm.get('fechaNacimiento')?.hasError('menorEdad')">Debes ser mayor de 18 años.</ng-container>
                            </span>
                            <svg class="lucide lucide-message-circle-warning" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path>
                                <path d="M12 8v4"></path>
                                <path d="M12 16h.01"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Correo -->
                <div class="form-group">
                    <label>Correo:</label>
                    <div class="input-wrapper">
                        <input type="email" formControlName="correo" placeholder="ejemplo@optica.com" appEnterNext>
                        <div class="warning-icon" *ngIf="registerForm.get('correo')?.invalid && (registerForm.get('correo')?.touched || registerForm.get('correo')?.dirty || registerForm.get('correo')?.hasError('emailTomado'))">
                            <span class="tooltip">
                                <ng-container *ngIf="registerForm.get('correo')?.hasError('required')">Correo requerido.<br></ng-container>
                                <ng-container *ngIf="registerForm.get('correo')?.hasError('email')">Formato de correo inválido.<br></ng-container>
                                <ng-container *ngIf="registerForm.get('correo')?.hasError('emailTomado')">Este correo ya está registrado.</ng-container>
                            </span>
                            <svg class="lucide lucide-message-circle-warning" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path>
                                <path d="M12 8v4"></path>
                                <path d="M12 16h.01"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Contraseña -->
                <div class="form-group">
                    <label>Contraseña:</label>
                    <div class="input-wrapper">
                        <input [type]="showRegisterPassword() ? 'text' : 'password'" formControlName="password" placeholder="********" appEnterNext>
                        <button type="button" class="toggle-password" (click)="togglePasswordVisibility('register')" tabindex="-1">
                            <svg *ngIf="!showRegisterPassword()" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                            <svg *ngIf="showRegisterPassword()" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/>
                                <path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/>
                                <path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"/>
                                <line x1="2" x2="22" y1="2" y2="22"/>
                            </svg>
                        </button>
                        <div class="warning-icon" *ngIf="registerForm.get('password')?.touched && registerForm.get('password')?.invalid">
                            <span class="tooltip">
                                <ng-container *ngIf="registerForm.get('password')?.hasError('required')">Contraseña requerida.<br></ng-container>
                                <ng-container *ngIf="registerForm.get('password')?.hasError('minlength')">Mínimo 8 caracteres.<br></ng-container>
                                <ng-container *ngIf="registerForm.get('password')?.hasError('weakPassword')">Debe incluir mayúscula, minúscula, número y símbolo.</ng-container>
                            </span>
                            <svg class="lucide lucide-message-circle-warning" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path>
                                <path d="M12 8v4"></path>
                                <path d="M12 16h.01"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Confirmar contraseña -->
                <div class="form-group">
                    <label>Confirmar contraseña:</label>
                    <div class="input-wrapper">
                        <input [type]="showConfirmPassword() ? 'text' : 'password'" formControlName="confirmPassword" placeholder="********" appEnterNext>
                        <button type="button" class="toggle-password" (click)="togglePasswordVisibility('confirm')" tabindex="-1">
                            <svg *ngIf="!showConfirmPassword()" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                            <svg *ngIf="showConfirmPassword()" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/>
                                <path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/>
                                <path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"/>
                                <line x1="2" x2="22" y1="2" y2="22"/>
                            </svg>
                        </button>
                        <div class="warning-icon" *ngIf="registerForm.get('confirmPassword')?.touched && registerForm.hasError('passwordMismatch')">
                            <span class="tooltip">
                                Las contraseñas no coinciden.
                            </span>
                            <svg class="lucide lucide-message-circle-warning" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path>
                                <path d="M12 8v4"></path>
                                <path d="M12 16h.01"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <button class="auth-btn" type="submit" [disabled]="registerForm.invalid || isLoading">
                    <span *ngIf="!isLoading">Crear Cuenta</span>
                    <span *ngIf="isLoading">Creando cuenta...</span>
                </button>
            </form>

            <div class="auth-links">
                <a (click)="goTo(1)">¿Ya tienes una cuenta? Inicia sesión</a>
            </div>
        </div>

        <!-- RECUPERAR CONTRASEÑA -->
        <div class="form-slide" *ngIf="activeSlide() === 3" @fadeSlide>
            <!-- FORMULARIO DE RECUPERACIÓN -->
            <div *ngIf="!emailSent()" @fadeSlide>
                <h2 class="auth-title">¿Olvidaste tu contraseña?</h2>
                <p class="auth-subtitle">
                    Ingresa tu correo electrónico y te enviaremos un enlace para restablecer tu contraseña
                </p>

                <!-- Mensaje de error -->
                <div class="alert alert-danger" *ngIf="errorMessage()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg> {{ errorMessage() }}
                </div>

                <form class="auth-form" [formGroup]="forgotForm" (ngSubmit)="onForgotPassword()">
                    <!-- Email -->
                    <div class="form-group">
                        <label>Correo electrónico:</label>
                        <div class="input-wrapper">
                            <input type="email" formControlName="email" placeholder="ejemplo@optica.com" [class.invalid]="forgotForm.get('email')?.invalid && forgotForm.get('email')?.touched" appEnterNext autofocus>
                            <div class="warning-icon" *ngIf="forgotForm.get('email')?.touched && forgotForm.get('email')?.invalid">
                                <span class="tooltip">
                                    <ng-container *ngIf="forgotForm.get('email')?.hasError('required')">Correo requerido.<br></ng-container>
                                    <ng-container *ngIf="forgotForm.get('email')?.hasError('email')">Formato de correo inválido.</ng-container>
                                </span>
                                <svg class="lucide lucide-message-circle-warning" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path>
                                    <path d="M12 8v4"></path>
                                    <path d="M12 16h.01"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <button class="auth-btn" type="submit" [disabled]="forgotForm.invalid || isLoading">
                        <span *ngIf="!isLoading">Enviar enlace de recuperación</span>
                        <span *ngIf="isLoading">Enviando...</span>
                    </button>
                </form>

                <div style="text-align: center; margin-top: 1.5rem;">
                    <a (click)="goTo(1)" style="color: var(--color-primary); cursor: pointer; text-decoration: none; font-size: 0.95rem;">
                        ← Volver al inicio de sesión
                    </a>
                </div>
            </div>

            <!-- MENSAJE DE ÉXITO -->
            <div *ngIf="emailSent()" @fadeSlide>
                <div style="text-align: center; padding: 2rem 0;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--color-success)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin: 0 auto 1.5rem;">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>

                    <h2 class="auth-title">¡Correo enviado!</h2>
                    <p class="auth-subtitle" style="margin-bottom: 1.5rem;">
                        Hemos enviado un enlace de recuperación a <strong>{{ forgotForm.value.email }}</strong>
                    </p>

                    <div class="alert alert-info" style="text-align: left; margin-bottom: 1.5rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        <div>
                            <strong>Instrucciones:</strong>
                            <ol style="margin: 0.5rem 0 0 1.5rem; padding: 0;">
                                <li>Revisa tu bandeja de entrada</li>
                                <li>Haz clic en el enlace del correo</li>
                                <li>Se abrirá tu navegador para crear una nueva contraseña</li>
                                <li>Luego podrás iniciar sesión con tu nueva contraseña</li>
                            </ol>
                        </div>
                    </div>

                    <button class="auth-btn" (click)="backToLogin()" type="button">
                        Volver al inicio de sesión
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>