<div class="historial-container" *ngIf="!loading">
    <div class="historial-card">
        <!-- HEADER -->
        <div class="historial-header">
            <h3>{{ cliente?.nombres }} {{ cliente?.apellidos }} - Historia Clínica</h3>
        </div>

        <!-- BODY -->
        <form [formGroup]="clienteForm" class="cliente-form-section">
            <!-- INFORMACIÓN PERSONAL -->
            <div class="section-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-contact-icon lucide-contact"><path d="M16 2v2"/><path d="M7 22v-2a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2"/><path d="M8 2v2"/><circle cx="12" cy="11" r="3"/><rect x="3" y="4" width="18" height="18" rx="2"/></svg>
                <h4 style="margin-left: 3px;"> Información Personal</h4>
            </div>

            <div class="cliente-grid">
                <div class="input-group">
                    <label>Nombres *</label>
                    <input type="text" formControlName="nombres" placeholder="Ej: Juan Carlos">
                    <span class="error-msg" *ngIf="esInvalidoCliente('nombres')">
            {{ getMensajeErrorCliente('nombres') }}
          </span>
                </div>

                <div class="input-group">
                    <label>Apellidos *</label>
                    <input type="text" formControlName="apellidos" placeholder="Ej: Pérez García">
                    <span class="error-msg" *ngIf="esInvalidoCliente('apellidos')">
            {{ getMensajeErrorCliente('apellidos') }}
          </span>
                </div>

                <div class="input-group">
                    <label>Cédula *</label>
                    <input type="text" formControlName="cedula" placeholder="1234567890" maxlength="10">
                    <span class="error-msg" *ngIf="esInvalidoCliente('cedula')">
            {{ getMensajeErrorCliente('cedula') }}
          </span>
                </div>

                <div class="input-group">
                    <label>Teléfono *</label>
                    <input type="text" formControlName="telefono" placeholder="0987654321" maxlength="10">
                    <span class="error-msg" *ngIf="esInvalidoCliente('telefono')">
            {{ getMensajeErrorCliente('telefono') }}
          </span>
                </div>

                <div class="input-group">
                    <label>Email</label>
                    <input type="email" formControlName="email" placeholder="ejemplo@correo.com">
                    <span class="error-msg" *ngIf="esInvalidoCliente('email')">
            {{ getMensajeErrorCliente('email') }}
          </span>
                </div>

                <div class="input-group">
                    <label>País</label>
                    <input type="text" formControlName="pais" placeholder="Ecuador">
                </div>

                <div class="input-group">
                    <label>Provincia</label>
                    <select formControlName="provincia">
            <option value="">Seleccione una provincia</option>
            <option *ngFor="let prov of provinciasEcuador" [value]="prov">{{ prov }}</option>
          </select>
                </div>

                <div class="input-group">
                    <label>Ciudad</label>
                    <input type="text" formControlName="ciudad" placeholder="Ej: Quito">
                </div>

                <div class="input-group full-width">
                    <label>Dirección</label>
                    <input type="text" formControlName="direccion" placeholder="Ej: Av. Principal 123 y Secundaria">
                </div>
            </div>
        </form>

        <!-- HISTORIAL CLÍNICO -->
        <form [formGroup]="form" (ngSubmit)="guardar()">
            <div class="section-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard-clock-icon lucide-clipboard-clock"><path d="M16 14v2.2l1.6 1"/><path d="M16 4h2a2 2 0 0 1 2 2v.832"/><path d="M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h2"/><circle cx="16" cy="16" r="6"/><rect x="8" y="2" width="8" height="4" rx="1"/></svg>
                <h4 style="margin-left: 3px ;">Historial Clínico</h4>
            </div>

            <!-- MEDIDAS PRINCIPALES -->
            <div class="section-medidas">
                <div class="input-group">
                    <label>DP</label>
                    <input type="number" step="0.5" formControlName="dp" placeholder="62">
                </div>
                <div class="input-group">
                    <label>ADD</label>
                    <input type="number" step="0.25" formControlName="add" placeholder="2.00">
                </div>
                <div class="input-group">
                    <label>Altura</label>
                    <input type="number" step="0.1" formControlName="altura" placeholder="18.5">
                </div>
            </div>

            <!-- OD / OI -->
            <div class="ojos-grid">
                <!-- OD -->
                <div class="ojo-card">
                    <h4>Ojo Derecho (OD)</h4>
                    <div class="ojo-inputs">
                        <div class="input-group">
                            <label>Esfera</label>
                            <input type="number" step="0.25" formControlName="odEsfera">
                        </div>
                        <div class="input-group">
                            <label>Cilindro</label>
                            <input type="number" step="0.25" formControlName="odCilindro">
                        </div>
                        <div class="input-group">
                            <label>Eje</label>
                            <input type="number" step="1" min="0" max="180" formControlName="odEje">
                        </div>
                    </div>
                </div>

                <!-- OI -->
                <div class="ojo-card">
                    <h4>Ojo Izquierdo (OI)</h4>
                    <div class="ojo-inputs">
                        <div class="input-group">
                            <label>Esfera</label>
                            <input type="number" step="0.25" formControlName="oiEsfera">
                        </div>
                        <div class="input-group">
                            <label>Cilindro</label>
                            <input type="number" step="0.25" formControlName="oiCilindro">
                        </div>
                        <div class="input-group">
                            <label>Eje</label>
                            <input type="number" step="1" min="0" max="180" formControlName="oiEje">
                        </div>
                    </div>
                </div>
            </div>

            <!-- EXTRA -->
            <div class="section-extra">
                <div class="input-group">
                    <label>De</label>
                    <input type="text" formControlName="de" placeholder="Cerca / Lejos / DP">
                </div>
                <div class="input-group">
                    <label>Color</label>
                    <input type="text" formControlName="color" placeholder="Negro / Transparente">
                </div>
            </div>

            <!-- OBSERVACIÓN -->
            <div class="section-observacion">
                <label>Observación</label>
                <textarea rows="3" formControlName="observacion" placeholder="Notas adicionales..."></textarea>
            </div>

            <!-- FOOTER -->
            <div class="historial-footer">
                <button type="button" class="btn-cancel" (click)="cancelar()">
          Cancelar
        </button>
                <button type="submit" class="btn-save" [disabled]="form.invalid || clienteForm.invalid">
          Guardar Todo
        </button>
            </div>
        </form>
    </div>
</div>