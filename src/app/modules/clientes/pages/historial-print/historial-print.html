<div *ngIf="!loading && historial && cliente" class="ticket">

    <div class="t-center t-bold">ÓPTICA MACÍAS</div>
    <div class="t-center t-small">Historial Clínico</div>
    <div class="t-center t-small">Machala - Ecuador</div>

    <div class="t-hr"></div>

    <!-- Datos del cliente -->
    <div class="t-small">
        <div><b>Cliente:</b> {{ cliente.nombres }} {{ cliente.apellidos }}</div>
        <div><b>Cédula:</b> {{ cliente.cedula || '-' }}</div>
        <div><b>Tel:</b> {{ cliente.telefono || '-' }}</div>
        <div>
            <b>Fecha:</b> {{ cliente.createdAt?.toDate() | date:'dd/MM/yyyy HH:mm' }}
        </div>
    </div>

    <div class="t-hr"></div>

    <!-- Medidas -->
    <div class="t-bold t-small">MEDIDAS</div>

    <div class="t-small">
        <b>OD</b><br> Esf {{ historial.odEsfera ? (historial.odEsfera | number:'1.2-2') : '-' }} Cil {{ historial.odCilindro ? (historial.odCilindro | number:'1.2-2') : '-' }} Eje {{ historial.odEje ? (historial.odEje | number:'1.2-2') : '-' }}<br> AVSC
        {{ historial.odAVSC ? (historial.odAVSC | number:'1.2-2') : '-' }} AVCC {{ historial.odAVCC ? (historial.odAVCC | number:'1.2-2') : '-' }}
    </div>


    <div class="t-small" style="margin-top:4px">
        <b>OI</b><br> Esf {{ historial.oiEsfera ? (historial.oiEsfera | number:'1.2-2') : '-' }} Cil {{ historial.oiCilindro ? (historial.oiCilindro | number:'1.2-2') : '-' }} Eje {{ historial.oiEje ? (historial.oiEje | number:'1.2-2') : '-' }}<br> AVSC
        {{ historial.oiAVSC ? (historial.oiAVSC | number:'1.2-2') : '-' }} AVCC {{ historial.oiAVCC ? (historial.oiAVCC | number:'1.2-2') : '-' }}
    </div>

    <div class="t-hr"></div>

    <!-- Medidas adicionales -->
    <div class="t-small" *ngIf="historial.add !== null && historial.add !== undefined">
        <b>ADD:</b> {{ historial.add | number:'1.2-2' }}
    </div>

    <div class="t-small" *ngIf="historial.dp !== null && historial.dp !== undefined">
        <b>DP:</b> {{ historial.dp | number:'1.2-2' }}
    </div>

    <div class="t-small" *ngIf="historial.altura !== null && historial.altura !== undefined">
        <b>Altura:</b> {{ historial.altura | number:'1.2-2' }} cm
    </div>

    <div class="t-small" *ngIf="historial.de">
        <b>DE:</b> {{ historial.de }}
    </div>

    <div class="t-small" *ngIf="historial.color">
        <b>Color:</b> {{ historial.color }}
    </div>

    <div class="t-hr"></div>

    <!-- Observaciones -->
    <div class="t-small" *ngIf="historial.observacion">
        <b>Obs:</b><br> {{ historial.observacion }}
    </div>

    <div class="t-hr"></div>

    <!-- Información de registro -->
    <div class="t-small">
        <div *ngIf="historial.doctor">
            <b>Doctor:</b> {{ historial.doctor }}
        </div>
        <div>
            <b>Registro:</b> {{ historial.createdAt?.toDate() | date:'dd/MM/yyyy HH:mm' }}
        </div>
    </div>

    <div class="t-hr"></div>

    <!-- INFORMACIÓN DE FACTURAS -->
    <div *ngIf="facturas && facturas.length > 0">
        <div class="t-bold t-small">FACTURAS PENDIENTES</div>

        <div *ngFor="let factura of facturas" class="t-small" style="margin-bottom: 12px;">
            <div><b>Fac:</b> {{ factura.id || '-' }}</div>
            <div><b>Total:</b> ${{ factura.total | number:'1.2-2' }}</div>
            <div><b>Abono:</b> ${{ factura.abonado | number:'1.2-2' }}</div>
            <div><b>Restante:</b> ${{ calcularTotalRestante(factura) | number:'1.2-2' }}</div>
            <div *ngIf="tieneArmazon(factura)" style="color: #333; margin-top: 4px;">
                ✓ Armazón Incluido
            </div>
            <div *ngIf="!tieneArmazon(factura)" style="color: #666; margin-top: 4px;">
                - Armazón Propio
            </div>
        </div>
    </div>

    <div class="t-hr"></div>

    <div class="t-center t-small">Documento informativo</div>
    <div class="t-center t-small">No válido como factura</div>

</div>