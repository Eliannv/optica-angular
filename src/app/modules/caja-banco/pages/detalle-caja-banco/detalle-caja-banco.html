<div class="caja-container">
    <div class="caja-card">
        <div class="caja-header">
            <h1 class="caja-title">üìä Detalle Caja Banco</h1>
            <div style="display:flex; gap:8px;">
                <button class="btn-secondary" (click)="volver()">‚Üê Volver</button>
                <button class="btn-primary" (click)="imprimirCaja()">üñ®Ô∏è Imprimir</button>
            </div>
        </div>

        <div class="caja-body" *ngIf="caja">
            <!-- Informaci√≥n general -->
            <div style="margin-bottom:20px; padding:15px; background:#f9f9f9; border-radius:8px;">
                <p><strong>Fecha:</strong> {{ formatoFecha(caja?.fecha) }}</p>
                <p><strong>Usuario:</strong> {{ caja?.usuario_nombre || '-' }}</p>
                <p><strong>Estado:</strong> <span class="badge" [class.badge-success]="caja?.estado === 'ABIERTA'" [class.badge-secondary]="caja?.estado !== 'ABIERTA'">{{ caja?.estado }}</span></p>
                <p><strong>Saldo Inicial:</strong> {{ formatoMoneda(caja?.saldo_inicial || 0) }}</p>
                <p><strong>Saldo Actual:</strong> <strong style="color:#28a745; font-size:1.2em;">{{ formatoMoneda(caja?.saldo_actual || 0) }}</strong></p>
            </div>

            <!-- Cajas Chicas -->
            <h2 style="margin-top:25px; margin-bottom:15px;">Cajas Chicas del D√≠a</h2>
            <div class="tabla-responsive" *ngIf="cajasChicas.length > 0; else sinCajasChicas">
                <table class="tabla">
                    <thead>
                        <tr>
                            <th>Fecha/Hora</th>
                            <th>Usuario</th>
                            <th class="text-right">Monto Inicial</th>
                            <th class="text-right">Saldo Final</th>
                            <th>Estado</th>
                            <th class="text-right">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let cc of cajasChicas">
                            <td>{{ formatoFecha(cc.fecha) }}</td>
                            <td>{{ cc.usuario_nombre || '-' }}</td>
                            <td class="text-right">{{ formatoMoneda(cc.monto_inicial || 0) }}</td>
                            <td class="text-right font-bold">{{ formatoMoneda(cc.monto_actual || 0) }}</td>
                            <td><span class="badge" [class.badge-success]="cc.estado === 'ABIERTA'" [class.badge-secondary]="cc.estado !== 'ABIERTA'">{{ cc.estado }}</span></td>
                            <td class="text-right">
                                <button class="btn-action btn-action-delete" (click)="eliminarCajaChica(cc)" title="Eliminar">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M3 6h18"/></svg>
                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <ng-template #sinCajasChicas>
                <p style="color:#999;">No hay cajas chicas para este d√≠a</p>
            </ng-template>

            <!-- Movimientos -->
            <h2 style="margin-top:25px; margin-bottom:15px;">Movimientos</h2>
            <div class="tabla-responsive" *ngIf="movimientos.length > 0; else sinMovimientos">
                <table class="tabla">
                    <thead>
                        <tr>
                            <th>Fecha/Hora</th>
                            <th>Tipo</th>
                            <th>Categor√≠a</th>
                            <th>Descripci√≥n</th>
                            <th class="text-right">Monto</th>
                            <th>Referencia</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let mov of movimientos" [class.tabla-row-ingreso]="mov.tipo === 'INGRESO'" [class.tabla-row-egreso]="mov.tipo !== 'INGRESO'">
                            <td>{{ formatoFecha(mov.fecha) }}</td>
                            <td><span class="badge" [class.badge-success]="mov.tipo === 'INGRESO'" [class.badge-danger]="mov.tipo !== 'INGRESO'">{{ mov.tipo }}</span></td>
                            <td>{{ mov.categoria }}</td>
                            <td>{{ mov.descripcion }}</td>
                            <td class="text-right" [class.text-success]="mov.tipo === 'INGRESO'" [class.text-danger]="mov.tipo !== 'INGRESO'">{{ mov.tipo === 'INGRESO' ? '+' : '-' }}{{ formatoMoneda(mov.monto || 0) }}</td>
                            <td>{{ mov.referencia || '-' }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <ng-template #sinMovimientos>
                <p style="color:#999;">No hay movimientos registrados</p>
            </ng-template>
        </div>

        <div class="caja-body" *ngIf="cargando">
            <p style="text-align:center; color:#999;">Cargando...</p>
        </div>
    </div>
</div>