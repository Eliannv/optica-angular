<div class="container mt-4">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">{{ esEdicion ? 'Editar Proveedor' : 'Crear Nuevo Proveedor' }}</h3>
        </div>
        <div class="card-body">
            <form>
                <div class="row">
                    <!-- Código del Proveedor -->
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Código del Proveedor</label>
                            <div class="input-with-validation">
                                <input type="text" class="form-control" [class.is-invalid]="validaciones.codigo.mensaje && !validaciones.codigo.valido" [class.is-valid]="validaciones.codigo.valido" [(ngModel)]="proveedor.codigo" (input)="validarCodigo()" (blur)="validarCodigo()" name="codigo"
                                    appEnterNext placeholder="Ej: P0001, PROV1234" [disabled]="esEdicion">
                                <div class="validation-feedback">
                                    <span *ngIf="validaciones.codigo.mensaje && !validaciones.codigo.valido" class="text-danger">
                                        <i class="bi bi-x-circle"></i> {{ validaciones.codigo.mensaje }}
                                    </span>
                                    <span *ngIf="validaciones.codigo.valido" class="text-success">
                                        <i class="bi bi-check-circle"></i> {{ validaciones.codigo.mensaje }}
                                    </span>
                                </div>
                            </div>
                            <small class="form-text text-muted">{{ esEdicion ? 'Este campo no se puede modificar' : 'Mínimo 1 letra y 4 números (opcional)' }}</small>
                        </div>
                    </div>

                    <!-- Código de Lugar -->
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Código de Lugar (Provincia)</label>
                            <div class="input-with-validation">
                                <input type="text" class="form-control" [class.is-invalid]="validaciones.codigoLugar.mensaje && !validaciones.codigoLugar.valido" [class.is-valid]="validaciones.codigoLugar.valido" [(ngModel)]="proveedor.direccion!.codigoLugar" (input)="validarCodigoLugar()"
                                    appEnterNext (blur)="validarCodigoLugar()" name="codigoLugar" placeholder="07" maxlength="2">
                                <div class="validation-feedback">
                                    <span *ngIf="validaciones.codigoLugar.mensaje && !validaciones.codigoLugar.valido" class="text-danger">
                                        <i class="bi bi-x-circle"></i> {{ validaciones.codigoLugar.mensaje }}
                                    </span>
                                    <span *ngIf="validaciones.codigoLugar.valido" class="text-success">
                                        <i class="bi bi-check-circle"></i> {{ validaciones.codigoLugar.mensaje }}
                                    </span>
                                </div>
                            </div>
                            <small class="form-text text-muted">07 = El Oro - Pasaje</small>
                        </div>
                    </div>
                </div>

                <!-- Nombre del Proveedor -->
                <div class="form-group">
                    <label class="form-label">Nombre del Proveedor *</label>
                    <div class="input-with-validation">
                        <input type="text" class="form-control" [class.is-invalid]="validaciones.nombre.mensaje && !validaciones.nombre.valido" [class.is-valid]="validaciones.nombre.valido" [(ngModel)]="proveedor.nombre" (blur)="validarNombre()" name="nombre" placeholder="Ej: Distribuidora Óptica S.A."
                            appEnterNext required>
                        <div class="validation-feedback">
                            <span *ngIf="validandoNombre" class="text-muted d-inline-flex align-items-center gap-1">
                                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Validando nombre...
                            </span>
                            <span *ngIf="validaciones.nombre.mensaje && !validaciones.nombre.valido" class="text-danger">
                                <i class="bi bi-x-circle"></i> {{ validaciones.nombre.mensaje }}
                            </span>
                            <span *ngIf="validaciones.nombre.valido" class="text-success">
                                <i class="bi bi-check-circle"></i> {{ validaciones.nombre.mensaje }}
                            </span>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- RUC -->
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">RUC *</label>
                            <div class="input-with-validation">
                                <input type="text" class="form-control" [class.is-invalid]="validaciones.ruc.mensaje && !validaciones.ruc.valido" [class.is-valid]="validaciones.ruc.valido" [(ngModel)]="proveedor.ruc" (input)="validarRUC()" (blur)="validarRUC()" name="ruc" placeholder="Ej: 0701234567001"
                                    appEnterNext maxlength="13" required>
                                <div class="validation-feedback">
                                    <span *ngIf="validandoRuc" class="text-muted d-inline-flex align-items-center gap-1">
                                        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Validando RUC...
                                    </span>
                                    <span *ngIf="validaciones.ruc.mensaje && !validaciones.ruc.valido" class="text-danger">
                                        <i class="bi bi-x-circle"></i> {{ validaciones.ruc.mensaje }}
                                    </span>
                                    <span *ngIf="validaciones.ruc.valido" class="text-success">
                                        <i class="bi bi-check-circle"></i> {{ validaciones.ruc.mensaje }}
                                    </span>
                                </div>
                            </div>
                            <small class="form-text text-muted">13 dígitos - Debe iniciar con código de provincia (07 para El Oro)</small>
                        </div>
                    </div>

                    <!-- Representante -->
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Representante</label>
                            <input type="text" class="form-control" [(ngModel)]="proveedor.representante" name="representante" placeholder="Nombre del representante" appEnterNext>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- Teléfono Principal -->
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Teléfono Principal</label>
                            <div class="input-with-validation">
                                <input type="tel" class="form-control" [class.is-invalid]="validaciones.telefonoPrincipal.mensaje && !validaciones.telefonoPrincipal.valido" [class.is-valid]="validaciones.telefonoPrincipal.valido" [(ngModel)]="proveedor.telefonos!.principal" (input)="validarTelefono(proveedor.telefonos!.principal || '', 'principal')"
                                    appEnterNext (blur)="validarTelefono(proveedor.telefonos!.principal || '', 'principal')" name="telefonoPrincipal" placeholder="0991234567 ó 072931234" maxlength="10">
                                <div class="validation-feedback">
                                    <span *ngIf="validaciones.telefonoPrincipal.mensaje && !validaciones.telefonoPrincipal.valido" class="text-danger">
                                        <i class="bi bi-x-circle"></i> {{ validaciones.telefonoPrincipal.mensaje }}
                                    </span>
                                    <span *ngIf="validaciones.telefonoPrincipal.valido" class="text-success">
                                        <i class="bi bi-check-circle"></i> {{ validaciones.telefonoPrincipal.mensaje }}
                                    </span>
                                </div>
                            </div>
                            <small class="form-text text-muted">Celular: 09XXXXXXXX | Convencional El Oro: 07XXXXXXX</small>
                        </div>
                    </div>

                    <!-- Teléfono Secundario -->
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">Teléfono Secundario</label>
                            <div class="input-with-validation">
                                <input type="tel" class="form-control" [class.is-invalid]="validaciones.telefonoSecundario.mensaje && !validaciones.telefonoSecundario.valido" [class.is-valid]="validaciones.telefonoSecundario.valido" [(ngModel)]="proveedor.telefonos!.secundario" (input)="validarTelefono(proveedor.telefonos!.secundario || '', 'secundario')"
                                    appEnterNext (blur)="validarTelefono(proveedor.telefonos!.secundario || '', 'secundario')" name="telefonoSecundario" placeholder="0991234568 ó 072931235" maxlength="10">
                                <div class="validation-feedback">
                                    <span *ngIf="validaciones.telefonoSecundario.mensaje && !validaciones.telefonoSecundario.valido" class="text-danger">
                                        <i class="bi bi-x-circle"></i> {{ validaciones.telefonoSecundario.mensaje }}
                                    </span>
                                    <span *ngIf="validaciones.telefonoSecundario.valido" class="text-success">
                                        <i class="bi bi-check-circle"></i> {{ validaciones.telefonoSecundario.mensaje }}
                                    </span>
                                </div>
                            </div>
                            <small class="form-text text-muted">Celular: 09XXXXXXXX | Convencional El Oro: 07XXXXXXX</small>
                        </div>
                    </div>
                </div>

                <!-- Dirección -->
                <div class="form-group">
                    <label class="form-label">Dirección</label>
                    <input type="text" class="form-control" [(ngModel)]="proveedor.direccion!.direccion" name="direccion" placeholder="Dirección completa del proveedor" appEnterNext>
                </div>
            </form>
        </div>
        <div class="card-footer d-flex justify-between">
            <button class="btn btn-secondary" (click)="cancelar()">Cancelar</button>
            <button class="btn btn-primary" (click)="guardar()" [disabled]="!puedeGuardar">Guardar Proveedor</button>
        </div>
    </div>
</div>