<div class="ingresos-container">
    <div class="ingresos-card">

        <!-- HEADER -->
        <div class="ingresos-header">
            <div class="header-content">
                <h3 class="ingresos-title">Historial de Ingresos / Facturas</h3>
                <button class="btn-primary" (click)="nuevoIngreso()">
          <span>+ Nuevo Ingreso</span>
        </button>
            </div>

            <!-- Filtro por estado -->
            <div class="filters-row">
                <div class="filter-group">
                    <label class="filter-label">Estado</label>
                    <select class="search-input" [(ngModel)]="filtroEstado" (ngModelChange)="filtrar()">
            <option value="TODOS">üìã Todos</option>
            <option value="BORRADOR">üìù Borrador</option>
            <option value="FINALIZADO">‚úÖ Finalizado</option>
          </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Fecha</label>
                    <select class="search-input" [(ngModel)]="filtroFecha" (ngModelChange)="filtrar()">
            <option value="TODAS">üìÖ Todas</option>
            <option value="HOY">Hoy</option>
            <option value="SEMANA">√öltima semana</option>
            <option value="MES">√öltimo mes</option>
            <option value="ANO">√öltimo a√±o</option>
            <option value="ESPECIFICA">Fecha espec√≠fica</option>
          </select>
                </div>

                <div class="filter-group" *ngIf="filtroFecha === 'ESPECIFICA'">
                    <label class="filter-label">Seleccionar fecha</label>
                    <input type="date" class="search-input" [(ngModel)]="fechaEspecifica" (ngModelChange)="filtrar()">
                </div>
            </div>

            <!-- B√∫squeda -->
            <div class="search-container">
                <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
                <input class="search-input" placeholder="Buscar por N¬∞ factura, proveedor..." [(ngModel)]="term" (input)="filtrar()">
                <button class="clear-btn" *ngIf="term" (click)="term = ''; filtrar()">‚úï</button>
            </div>
        </div>

        <!-- BODY -->
        <div class="ingresos-body">

            <!-- TABLA DESKTOP -->
            <div class="table-wrapper desktop-only" *ngIf="totalIngresos > 0; else empty">
                <table class="ingresos-table">
                    <thead>
                        <tr>
                            <th class="col-fecha">Fecha</th>
                            <th class="col-proveedor">Proveedor</th>
                            <th class="col-factura">N¬∞ Factura</th>
                            <th class="col-tipo">Tipo</th>
                            <th class="col-total">Total</th>
                            <th class="col-estado">Estado</th>
                            <th class="col-acciones">Acciones</th>
                        </tr>
                    </thead>

                    <tbody>
                        <tr *ngFor="let ingreso of ingresosPaginados" class="ingreso-row">
                            <td class="col-fecha">
                                <span class="fecha-text">{{ formatearFecha(ingreso.fecha) }}</span>
                            </td>

                            <td class="col-proveedor">
                                <strong>{{ ingreso.proveedor }}</strong>
                            </td>

                            <td class="col-factura">
                                <span class="badge-factura">{{ ingreso.numeroFactura }}</span>
                            </td>

                            <td class="col-tipo">
                                <span class="badge-tipo" [class.badge-success]="ingreso.tipoCompra === 'CONTADO'" [class.badge-warning]="ingreso.tipoCompra === 'CREDITO'">
                  {{ ingreso.tipoCompra }}
                </span>
                            </td>

                            <td class="col-total">
                                <span class="precio">${{ (Number(ingreso.total) || 0).toFixed(2) }}</span>
                            </td>

                            <td class="col-estado">
                                <span class="badge" [class.badge-secondary]="ingreso.estado === 'BORRADOR'" [class.badge-primary]="ingreso.estado === 'FINALIZADO'">
                  {{ ingreso.estado === 'BORRADOR' ? 'üìù Borrador' : '‚úÖ Finalizado' }}
                </span>
                            </td>

                            <td class="col-acciones">
                                <button class="btn-ver" (click)="verDetalle(ingreso)">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye-icon lucide-eye"><path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"/><circle cx="12" cy="12" r="3"/></svg>
                </button>

                                <button class="btn-eliminar" *ngIf="ingreso.estado === 'BORRADOR'" (click)="eliminar(ingreso.id!, $event)">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-icon lucide-trash"><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M3 6h18"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- CARDS M√ìVIL -->
            <div class="mobile-cards mobile-only" *ngIf="totalIngresos > 0">
                <div class="ingreso-card-mobile" *ngFor="let ingreso of ingresosPaginados">
                    <div class="card-mobile-header" (click)="verDetalle(ingreso)">
                        <span class="badge-factura">{{ ingreso.numeroFactura }}</span>
                        <span class="badge" [class.badge-secondary]="ingreso.estado === 'BORRADOR'" [class.badge-primary]="ingreso.estado === 'FINALIZADO'">
              {{ ingreso.estado }}
            </span>
                    </div>

                    <div class="card-mobile-body" (click)="verDetalle(ingreso)">
                        <div class="info-row">
                            <span class="label">Proveedor</span>
                            <strong>{{ ingreso.proveedor }}</strong>
                        </div>

                        <div class="info-row">
                            <span class="label">Fecha</span>
                            <span>{{ formatearFecha(ingreso.fecha) }}</span>
                        </div>

                        <div class="info-row">
                            <span class="label">Tipo</span>
                            <span class="badge-tipo" [class.badge-success]="ingreso.tipoCompra === 'CONTADO'" [class.badge-warning]="ingreso.tipoCompra === 'CREDITO'">
                {{ ingreso.tipoCompra }}
              </span>
                        </div>

                        <div class="info-row">
                            <span class="label">Total</span>
                            <span class="precio">${{ (Number(ingreso.total) || 0).toFixed(2) }}</span>
                        </div>
                    </div>

                    <div class="card-mobile-footer">
                        <span class="ver-detalle" (click)="verDetalle(ingreso)">Ver detalles ‚Üí</span>

                        <button class="btn-eliminar-mobile" *ngIf="ingreso.estado === 'BORRADOR'" (click)="eliminar(ingreso.id!, $event)">
              üóëÔ∏è Eliminar
            </button>
                    </div>
                </div>
            </div>

            <!-- Controles de paginaci√≥n -->
            <div class="pagination-controls" *ngIf="totalIngresos > 0">
                <div class="pagination-info">
                    <span class="text-muted">
            Mostrando {{ (paginaActual - 1) * ingresosPorPagina + 1 }} -
            {{ Math.min(paginaActual * ingresosPorPagina, totalIngresos) }} de
            {{ totalIngresos }} ingresos
          </span>
                </div>

                <div class="pagination-buttons">
                    <button class="btn-pagination" [disabled]="paginaActual === 1" (click)="paginaAnterior()">
            ‚Üê Anterior
          </button>
                    <button class="btn-pagination" [disabled]="paginaActual * ingresosPorPagina >= totalIngresos" (click)="paginaSiguiente()">
            Siguiente ‚Üí
          </button>
                </div>
            </div>

            <!-- ESTADO VAC√çO -->
            <ng-template #empty>
                <div class="empty-state">
                    <div class="empty-icon">üì¶</div>
                    <p>No hay ingresos registrados</p>
                    <span>Crea tu primer ingreso para comenzar a registrar compras</span>
                </div>
            </ng-template>

        </div>
    </div>
</div>