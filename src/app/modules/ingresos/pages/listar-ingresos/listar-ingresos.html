<div class="ingresos-container">
    <div class="ingresos-card">

        <!-- HEADER -->
        <div class="ingresos-header">
            <div class="header-content">
                <h3 class="ingresos-title">Historial de Ingresos / Facturas</h3>
                <button class="btn-primary" (click)="nuevoIngreso()">
          <span>+ Nuevo Ingreso</span>
        </button>
            </div>

            <!-- Filtros -->
            <div class="filters-row">
                <div class="filter-group">
                    <label class="filter-label">Fecha</label>
                    <select class="search-input" [(ngModel)]="filtroFecha" (ngModelChange)="filtrar()">
            <option value="TODAS">üìÖ Todas</option>
            <option value="HOY">Hoy</option>
            <option value="SEMANA">√öltima semana</option>
            <option value="MES">√öltimo mes</option>
            <option value="ANO">√öltimo a√±o</option>
            <option value="ESPECIFICA">Fecha espec√≠fica</option>
          </select>
                </div>

                <div class="filter-group" *ngIf="filtroFecha === 'ESPECIFICA'">
                    <label class="filter-label">Seleccionar fecha</label>
                    <input type="date" class="search-input" [(ngModel)]="fechaEspecifica" (ngModelChange)="filtrar()">
                </div>
            </div>

            <!-- B√∫squeda -->
            <div class="search-container">
                <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
                <input class="search-input" placeholder="Buscar por N¬∞ factura, proveedor..." [(ngModel)]="term" (input)="filtrar()">
                <button class="clear-btn" *ngIf="term" (click)="term = ''; filtrar()">‚úï</button>
            </div>
        </div>

        <!-- BODY -->
        <div class="ingresos-body">

            <!-- RESUMEN ESTAD√çSTICO -->
            <div class="resumen-stats" *ngIf="totalIngresos > 0">
                <div class="stat-card">
                    <div class="stat-icon"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-package-search-icon lucide-package-search"><path d="M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14"/><path d="m7.5 4.27 9 5.15"/><polyline points="3.29 7 12 12 20.71 7"/><line x1="12" x2="12" y1="22" y2="12"/><circle cx="18.5" cy="15.5" r="2.5"/><path d="M20.27 17.27 22 19"/></svg></div>
                    <div class="stat-content">
                        <span class="stat-label">Total de Ingresos/Facturas</span>
                        <span class="stat-value">{{ totalIngresos }}</span>
                    </div>
                </div>

                <div class="stat-card stat-card-primary">
                    <div class="stat-icon"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-dollar-sign-icon lucide-dollar-sign"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></div>
                    <div class="stat-content">
                        <span class="stat-label">Total deuda sucursal</span>
                        <span class="stat-value">${{ obtenerTotalDeuda().toFixed(2) }}</span>
                    </div>
                </div>
            </div>

            <!-- TABLA DESKTOP -->
            <div class="table-wrapper desktop-only" *ngIf="totalIngresos > 0; else empty">
                <table class="ingresos-table">
                    <thead>
                        <tr>
                            <th class="col-fecha">Fecha</th>
                            <th class="col-proveedor">Proveedor</th>
                            <th class="col-factura">N¬∞ Factura</th>
                            <th class="col-tipo">Tipo</th>
                            <th class="col-total">Total</th>
                            <th class="col-estado">Estado</th>
                        </tr>
                    </thead>

                    <tbody>
                        <tr *ngFor="let ingreso of ingresosPaginados" class="ingreso-row">
                            <td class="col-fecha">
                                <span class="fecha-text">{{ formatearFecha(ingreso.fecha) }}</span>
                            </td>

                            <td class="col-proveedor">
                                <strong>{{ ingreso.proveedor }}</strong>
                            </td>

                            <td class="col-factura">
                                <span class="badge-factura">{{ ingreso.numeroFactura }}</span>
                            </td>

                            <td class="col-tipo">
                                <span class="badge-tipo" [class.badge-success]="ingreso.tipoCompra === 'CONTADO'" [class.badge-warning]="ingreso.tipoCompra === 'CREDITO'">
                  {{ ingreso.tipoCompra }}
                </span>
                            </td>

                            <td class="col-total">
                                <span class="precio">${{ (Number(ingreso.total) || 0).toFixed(2) }}</span>
                            </td>

                            <td class="col-acciones">
                                <button class="btn-ver" (click)="verIngreso(ingreso)">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye-icon lucide-eye"><path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"/><circle cx="12" cy="12" r="3"/></svg>
                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- CARDS M√ìVIL -->
            <div class="mobile-cards mobile-only" *ngIf="totalIngresos > 0">
                <div class="ingreso-card-mobile" *ngFor="let ingreso of ingresosPaginados">
                    <div class="card-mobile-header" (click)="verIngreso(ingreso)">
                        <span class="badge-factura">{{ ingreso.numeroFactura }}</span>
                        <span class="badge badge-primary">Finalizado</span>
                    </div>

                    <div class="card-mobile-body" (click)="verIngreso(ingreso)">
                        <div class="info-row">
                            <span class="label">Proveedor</span>
                            <strong>{{ ingreso.proveedor }}</strong>
                        </div>

                        <div class="info-row">
                            <span class="label">Fecha</span>
                            <span>{{ formatearFecha(ingreso.fecha) }}</span>
                        </div>

                        <div class="info-row">
                            <span class="label">Tipo</span>
                            <span class="badge-tipo" [class.badge-success]="ingreso.tipoCompra === 'CONTADO'" [class.badge-warning]="ingreso.tipoCompra === 'CREDITO'">
                {{ ingreso.tipoCompra }}
              </span>
                        </div>

                        <div class="info-row">
                            <span class="label">Total</span>
                            <span class="precio">${{ (Number(ingreso.total) || 0).toFixed(2) }}</span>
                        </div>
                    </div>

                    <div class="card-mobile-footer">
                        <span class="ver-detalle" (click)="verIngreso(ingreso)">Ver detalles ‚Üí</span>
                    </div>
                </div>
            </div>

            <!-- Controles de paginaci√≥n -->
            <div class="pagination-controls" *ngIf="totalIngresos > 0">
                <div class="pagination-info">
                    <span class="text-muted">
            Mostrando {{ (paginaActual - 1) * ingresosPorPagina + 1 }} -
            {{ Math.min(paginaActual * ingresosPorPagina, totalIngresos) }} de
            {{ totalIngresos }} ingresos
          </span>
                </div>

                <div class="pagination-buttons">
                    <button class="btn-pagination" [disabled]="paginaActual === 1" (click)="paginaAnterior()">
            ‚Üê Anterior
          </button>
                    <button class="btn-pagination" [disabled]="paginaActual * ingresosPorPagina >= totalIngresos" (click)="paginaSiguiente()">
            Siguiente ‚Üí
          </button>
                </div>
            </div>

            <!-- ESTADO VAC√çO -->
            <ng-template #empty>
                <div class="empty-state">
                    <div class="empty-icon">üì¶</div>
                    <p>No hay ingresos registrados</p>
                    <span>Crea tu primer ingreso para comenzar a registrar compras</span>
                </div>
            </ng-template>

        </div>
    </div>
</div>